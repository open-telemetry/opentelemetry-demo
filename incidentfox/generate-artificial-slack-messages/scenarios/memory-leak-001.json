{
  "scenario_id": "memory-leak-001",
  "scenario_type": "memory-leak",
  "title": "Email Service Memory Leak and OOM",
  "description": "Email service gradually leaks memory until OOMKilled, causing email delivery failures",
  "start_time": "2024-12-11T15:45:00Z",
  "services": {
    "email": {
      "channel": "#email-alert",
      "oncall_group": "@email-oncall",
      "role": "primary",
      "engineers": [
        "quinn"
      ]
    },
    "checkout": {
      "channel": "#checkout-alert",
      "oncall_group": "@checkout-oncall",
      "role": "affected",
      "engineers": [
        "henry",
        "iris"
      ]
    }
  },
  "timeline": [
    {
      "offset_seconds": 0,
      "type": "alert",
      "channel": "#email-alert",
      "severity": "warning",
      "title": "\ud83d\udfe1 High Memory Usage - Email Service",
      "details": "Memory usage growing steadily\n\n**Current Metrics:**\n\u2022 Memory: 850MB / 1GB (85%)\n\u2022 Memory growth: +50MB/min\n\u2022 Estimated time to OOM: 3 minutes",
      "metrics": {
        "memory_usage": "850MB / 1GB",
        "memory_percent": "85%",
        "growth_rate": "+50MB/min"
      },
      "thread_parent": null
    },
    {
      "offset_seconds": 8,
      "type": "message",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "On it",
      "thread_parent": 0
    },
    {
      "offset_seconds": 20,
      "type": "message",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "Memory keeps climbing. 850MB \u2192 920MB \u2192 980MB",
      "thread_parent": 0
    },
    {
      "offset_seconds": 35,
      "type": "message",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "Checking for memory leak in recent changes...",
      "thread_parent": 0
    },
    {
      "offset_seconds": 50,
      "type": "message",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "Memory at 1.02GB - pod is being OOMKilled",
      "thread_parent": 0
    },
    {
      "offset_seconds": 55,
      "type": "alert",
      "channel": "#email-alert",
      "severity": "critical",
      "title": "\ud83d\udd34 CRITICAL: Pod Crashed - Email Service",
      "details": "Pod OOMKilled and restarting\n\n**Status:**\n\u2022 Pod status: CrashLoopBackOff\n\u2022 Restart count: 1\n\u2022 Last exit: OOMKilled (137)",
      "metrics": {
        "pod_status": "CrashLoopBackOff",
        "restart_count": "1"
      },
      "thread_parent": null
    },
    {
      "offset_seconds": 58,
      "type": "alert",
      "channel": "#checkout-alert",
      "severity": "warning",
      "title": "\ud83d\udfe1 Email Service Timeouts",
      "details": "Cannot send confirmation emails\n\n**Current Metrics:**\n\u2022 Email timeouts: 45 in last 1 min\n\u2022 Orders without email: 45",
      "metrics": {
        "timeout_count": "45",
        "orders_no_email": "45"
      },
      "thread_parent": null
    },
    {
      "offset_seconds": 60,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "henry",
      "content": "Email service is down. Orders succeeding but no confirmation emails sent",
      "thread_parent": 6
    },
    {
      "offset_seconds": 65,
      "type": "message",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "Pod restarting... checking for memory leak. Let me look at feature flags",
      "thread_parent": 0
    },
    {
      "offset_seconds": 75,
      "type": "message",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "Found it. `emailMemoryLeak` flag is set to \"100x\" variant \ud83e\udd26",
      "thread_parent": 0
    },
    {
      "offset_seconds": 80,
      "type": "message",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "Disabling now",
      "thread_parent": 0
    },
    {
      "offset_seconds": 85,
      "type": "action",
      "channel": "#email-alert",
      "user": "quinn",
      "action_type": "flag_toggle",
      "action_details": "Disabled emailMemoryLeak feature flag",
      "content": "```\n$ flagctl set emailMemoryLeak off\nFlag disabled\n```",
      "thread_parent": 0
    },
    {
      "offset_seconds": 95,
      "type": "message",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "Pod started with clean memory. Monitoring...",
      "thread_parent": 0
    },
    {
      "offset_seconds": 105,
      "type": "message",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "Memory stable at 180MB. No more growth \u2713",
      "thread_parent": 0
    },
    {
      "offset_seconds": 110,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "henry",
      "content": "Email service back up. Emails sending again \u2705",
      "thread_parent": 6
    },
    {
      "offset_seconds": 115,
      "type": "resolution",
      "channel": "#email-alert",
      "user": "quinn",
      "content": "\u2705 **RESOLVED** - Email service stable\n\n**Root Cause:** Feature flag `emailMemoryLeak` was set to 100x variant, causing rapid memory leak\n\n**Fix:** Disabled flag and let pod restart with clean memory\n\n**Impact:**\n\u2022 Duration: ~2 minutes downtime\n\u2022 Missed emails: ~45 order confirmations\n\u2022 Will need to manually resend\n\n**Follow-up:**\n- [ ] Resend missed confirmation emails\n- [ ] Check why flag was enabled\n- [ ] Add memory limit alerting earlier (75% threshold)",
      "metrics_after": {
        "memory_usage": "180MB",
        "pod_status": "Running"
      },
      "thread_parent": 0
    }
  ],
  "metadata": {
    "severity": "SEV-2",
    "duration_seconds": 115,
    "services_impacted": 2,
    "root_cause": "Memory leak feature flag enabled",
    "resolution": "Disabled flag and restarted pod",
    "tags": [
      "memory-leak",
      "oom",
      "email",
      "restart"
    ]
  }
}