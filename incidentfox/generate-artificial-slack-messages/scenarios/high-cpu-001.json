{
  "scenario_id": "high-cpu-001",
  "scenario_type": "high-cpu",
  "title": "Ad Service CPU Saturation Causing Timeouts",
  "description": "Ad service CPU hits 100%, causing request timeouts and degraded frontend performance",
  "start_time": "2024-12-11T14:10:00Z",
  "services": {
    "ad": {
      "channel": "#ad-alert",
      "oncall_group": "@ad-oncall",
      "role": "primary",
      "engineers": [
        "olivia",
        "peter"
      ]
    },
    "frontend": {
      "channel": "#frontend-alert",
      "oncall_group": "@frontend-oncall",
      "role": "affected",
      "engineers": [
        "eve"
      ]
    }
  },
  "timeline": [
    {
      "offset_seconds": 0,
      "type": "alert",
      "channel": "#ad-alert",
      "severity": "critical",
      "title": "\ud83d\udd34 CRITICAL: High CPU Usage - Ad Service",
      "details": "CPU usage at 98%\n\n**Current Metrics:**\n\u2022 CPU: 98% (baseline: 25%)\n\u2022 Request queue: 145 (baseline: 2)\n\u2022 P95 latency: 2,800ms (baseline: 55ms)\n\u2022 Active threads: 200/200 (saturated)",
      "metrics": {
        "cpu_usage": "98%",
        "request_queue": "145",
        "p95_latency": "2800ms",
        "threads": "200/200"
      },
      "dashboard": "https://grafana.company.com/d/ad-service",
      "thread_parent": null
    },
    {
      "offset_seconds": 5,
      "type": "message",
      "channel": "#ad-alert",
      "user": "olivia",
      "content": "On it! CPU is maxed out \ud83d\udd25",
      "thread_parent": 0
    },
    {
      "offset_seconds": 15,
      "type": "alert",
      "channel": "#frontend-alert",
      "severity": "warning",
      "title": "\ud83d\udfe1 Ad Widget Timeouts - Frontend",
      "details": "Ad loading timeouts affecting page loads\n\n**Current Metrics:**\n\u2022 Ad timeout rate: 72%\n\u2022 Page load impact: +3.5s average\n\u2022 Users seeing blank ad spaces",
      "metrics": {
        "timeout_rate": "72%",
        "page_load_increase": "+3.5s"
      },
      "thread_parent": null
    },
    {
      "offset_seconds": 18,
      "type": "message",
      "channel": "#frontend-alert",
      "user": "eve",
      "content": "Ads are timing out everywhere. Pages loading but ad widgets are blank",
      "thread_parent": 2
    },
    {
      "offset_seconds": 20,
      "type": "message",
      "channel": "#ad-alert",
      "user": "peter",
      "content": "Looking at what's consuming CPU... seeing high compute activity",
      "thread_parent": 0
    },
    {
      "offset_seconds": 25,
      "type": "message",
      "channel": "#frontend-alert",
      "user": "eve",
      "content": "@ad-oncall Ad service seems unresponsive. Is there an outage?",
      "mentions": [
        "@ad-oncall"
      ],
      "thread_parent": 2
    },
    {
      "offset_seconds": 30,
      "type": "message",
      "channel": "#ad-alert",
      "user": "olivia",
      "content": "Checking logs... seeing tons of expensive operations being executed",
      "thread_parent": 0
    },
    {
      "offset_seconds": 35,
      "type": "message",
      "channel": "#ad-alert",
      "user": "peter",
      "content": "This looks like the high-CPU feature flag issue. Let me check...",
      "thread_parent": 0
    },
    {
      "offset_seconds": 40,
      "type": "message",
      "channel": "#ad-alert",
      "user": "peter",
      "content": "Yep. `adHighCpu` flag is enabled \ud83d\ude24",
      "thread_parent": 0
    },
    {
      "offset_seconds": 45,
      "type": "message",
      "channel": "#ad-alert",
      "user": "olivia",
      "content": "@eve We have an active incident. CPU is saturated. Working on fix now",
      "thread_parent": 0
    },
    {
      "offset_seconds": 50,
      "type": "action",
      "channel": "#ad-alert",
      "user": "peter",
      "action_type": "flag_toggle",
      "action_details": "Disabled adHighCpu feature flag",
      "content": "```\n$ flagctl set adHighCpu off\n```",
      "thread_parent": 0
    },
    {
      "offset_seconds": 55,
      "type": "message",
      "channel": "#ad-alert",
      "user": "olivia",
      "content": "CPU dropping: 98% \u2192 75% \u2192 45% \u2192 28% \ud83d\udcc9",
      "thread_parent": 0
    },
    {
      "offset_seconds": 60,
      "type": "message",
      "channel": "#ad-alert",
      "user": "olivia",
      "content": "Request queue clearing: 145 \u2192 85 \u2192 22 \u2192 3",
      "thread_parent": 0
    },
    {
      "offset_seconds": 65,
      "type": "message",
      "channel": "#frontend-alert",
      "user": "eve",
      "content": "Ads loading normally again! Timeout rate: 72% \u2192 15% \u2192 2% \u2728",
      "thread_parent": 2
    },
    {
      "offset_seconds": 70,
      "type": "resolution",
      "channel": "#ad-alert",
      "user": "peter",
      "content": "\u2705 **RESOLVED** - Ad service CPU back to normal\n\n**Root Cause:** Feature flag `adHighCpu` enabled, triggering expensive CPU operations\n\n**Fix:** Disabled feature flag\n\n**Metrics After:**\n\u2022 CPU: 26% (baseline: 25%) \u2713\n\u2022 P95 latency: 58ms (baseline: 55ms) \u2713\n\u2022 Request queue: 1 (baseline: 0-2) \u2713\n\n**Impact:**\n\u2022 Duration: ~1 minute\n\u2022 Ad revenue loss: ~$200 (timeouts = no impressions)\n\u2022 UX degradation: page loads 3x slower",
      "metrics_after": {
        "cpu_usage": "26%",
        "p95_latency": "58ms",
        "queue_depth": "1"
      },
      "thread_parent": 0
    },
    {
      "offset_seconds": 75,
      "type": "message",
      "channel": "#frontend-alert",
      "user": "eve",
      "content": "\u2705 All good on frontend. Page load times back to normal",
      "thread_parent": 2
    }
  ],
  "metadata": {
    "severity": "SEV-3",
    "duration_seconds": 75,
    "services_impacted": 2,
    "root_cause": "CPU saturation from feature flag",
    "resolution": "Disabled feature flag",
    "tags": [
      "cpu",
      "latency",
      "timeout",
      "user-experience"
    ]
  }
}