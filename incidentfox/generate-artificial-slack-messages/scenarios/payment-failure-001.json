{
  "scenario_id": "payment-failure-001",
  "scenario_type": "payment-failure",
  "title": "Payment Service 50% Failure Rate",
  "description": "Payment service starts failing 50% of requests, causing checkout failures and impacting revenue",
  "start_time": "2024-12-11T16:45:00Z",
  "services": {
    "payment": {
      "channel": "#payment-alert",
      "oncall_group": "@payment-oncall",
      "role": "primary",
      "engineers": [
        "frank",
        "grace"
      ]
    },
    "checkout": {
      "channel": "#checkout-alert",
      "oncall_group": "@checkout-oncall",
      "role": "downstream",
      "engineers": [
        "henry",
        "iris"
      ]
    },
    "accounting": {
      "channel": "#accounting-alert",
      "oncall_group": "@accounting-oncall",
      "role": "affected",
      "engineers": [
        "jack"
      ]
    }
  },
  "timeline": [
    {
      "offset_seconds": 0,
      "type": "alert",
      "channel": "#checkout-alert",
      "severity": "critical",
      "title": "\ud83d\udd34 CRITICAL: High Checkout Failure Rate",
      "details": "Checkout success rate dropped from 98% to 48%\n\n**Current Metrics:**\n\u2022 Success rate: 48% (was 98%)\n\u2022 Error rate: 52%\n\u2022 Failed checkouts: 78 in last 5 min\n\u2022 Primary error: `Payment processing failed (HTTP 500)`",
      "metrics": {
        "success_rate": "48%",
        "error_rate": "52%",
        "failed_checkouts_5m": "78"
      },
      "runbook": "https://wiki.company.com/runbooks/checkout-failures",
      "dashboard": "https://grafana.company.com/d/checkout-overview",
      "thread_parent": null
    },
    {
      "offset_seconds": 5,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "henry",
      "content": "Oh no. Looking at this now",
      "thread_parent": 0
    },
    {
      "offset_seconds": 10,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "iris",
      "content": "I see it. This is bad - we're literally losing money right now \ud83d\udcb8",
      "thread_parent": 0
    },
    {
      "offset_seconds": 20,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "henry",
      "content": "Checking logs... all errors are `HTTP 500` responses from payment service",
      "thread_parent": 0
    },
    {
      "offset_seconds": 28,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "henry",
      "content": "```\n2024-12-11 16:45:23 ERROR Failed to process payment for order_abc123\nPaymentServiceException: HTTP 500 from payment-service:8080\n  Response: {\"error\": \"Internal server error\"}\n```",
      "thread_parent": 0
    },
    {
      "offset_seconds": 35,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "iris",
      "content": "This looks like a payment service issue. Let me check their health...",
      "thread_parent": 0
    },
    {
      "offset_seconds": 40,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "iris",
      "content": "Weird - payment service health check is passing \u2705 but actual payment calls are failing ~50% of the time",
      "thread_parent": 0
    },
    {
      "offset_seconds": 45,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "henry",
      "content": "@payment-oncall Hey team, are you seeing issues with payment processing? We're getting 50% error rate on checkout",
      "mentions": [
        "@payment-oncall"
      ],
      "thread_parent": 0
    },
    {
      "offset_seconds": 50,
      "type": "alert",
      "channel": "#payment-alert",
      "severity": "warning",
      "title": "\ud83d\udfe1 High Error Rate - Payment Service",
      "details": "Error rate increased to 51.2%\n\n**Current Metrics:**\n\u2022 Error rate: 51.2% (was 0.2%)\n\u2022 HTTP 500 responses: 145 in last 5 min\n\u2022 Request rate: 285 req/s (normal)\n\u2022 P95 latency: 85ms (normal)",
      "metrics": {
        "error_rate": "51.2%",
        "http_500_count_5m": "145",
        "request_rate": "285 req/s",
        "p95_latency": "85ms"
      },
      "dashboard": "https://grafana.company.com/d/payment-overview",
      "thread_parent": null
    },
    {
      "offset_seconds": 53,
      "type": "message",
      "channel": "#payment-alert",
      "user": "frank",
      "content": "Yep just got the alert. Looking into it",
      "thread_parent": 8
    },
    {
      "offset_seconds": 60,
      "type": "message",
      "channel": "#payment-alert",
      "user": "grace",
      "content": "This is strange - service is healthy, latency is fine, but half the requests are returning 500",
      "thread_parent": 8
    },
    {
      "offset_seconds": 65,
      "type": "message",
      "channel": "#payment-alert",
      "user": "frank",
      "content": "Checking if there was a recent deployment... nope, last deploy was 3 days ago",
      "thread_parent": 8
    },
    {
      "offset_seconds": 72,
      "type": "message",
      "channel": "#payment-alert",
      "user": "grace",
      "content": "Let me check feature flags...",
      "thread_parent": 8
    },
    {
      "offset_seconds": 78,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "iris",
      "content": "Still seeing failures. This is costing us $$$ \ud83d\ude30",
      "thread_parent": 0
    },
    {
      "offset_seconds": 85,
      "type": "message",
      "channel": "#payment-alert",
      "user": "grace",
      "content": "FOUND IT! \ud83c\udfaf\n\n`paymentFailure` feature flag is ENABLED and set to \"50%\"",
      "thread_parent": 8,
      "reactions": [
        {
          "emoji": "eyes",
          "users": [
            "frank"
          ]
        },
        {
          "emoji": "facepalm",
          "users": [
            "frank"
          ]
        }
      ]
    },
    {
      "offset_seconds": 90,
      "type": "message",
      "channel": "#payment-alert",
      "user": "frank",
      "content": "Oh man... who enabled that? \ud83d\ude05",
      "thread_parent": 8
    },
    {
      "offset_seconds": 95,
      "type": "message",
      "channel": "#payment-alert",
      "user": "grace",
      "content": "Checking flagd history... it was enabled 15 minutes ago by @test-automation bot",
      "thread_parent": 8
    },
    {
      "offset_seconds": 100,
      "type": "message",
      "channel": "#payment-alert",
      "user": "grace",
      "content": "Must be from a test that didn't clean up. Disabling it now",
      "thread_parent": 8
    },
    {
      "offset_seconds": 105,
      "type": "action",
      "channel": "#payment-alert",
      "user": "grace",
      "action_type": "flag_toggle",
      "action_details": "Disabled paymentFailure feature flag",
      "content": "```\n$ kubectl exec -it flagd-xxx -- flagctl set paymentFailure off\nFlag 'paymentFailure' set to 'off'\n```",
      "thread_parent": 8
    },
    {
      "offset_seconds": 110,
      "type": "message",
      "channel": "#payment-alert",
      "user": "frank",
      "content": "Watching the error rate...",
      "thread_parent": 8
    },
    {
      "offset_seconds": 115,
      "type": "message",
      "channel": "#payment-alert",
      "user": "frank",
      "content": "Error rate dropping! 51% \u2192 38% \u2192 22% \u2192 8% \u2192 0.3% \u2728",
      "thread_parent": 8,
      "reactions": [
        {
          "emoji": "rocket",
          "users": [
            "grace"
          ]
        }
      ]
    },
    {
      "offset_seconds": 120,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "henry",
      "content": "Checkout success rate is recovering! 48% \u2192 72% \u2192 88% \u2192 96%",
      "thread_parent": 0,
      "reactions": [
        {
          "emoji": "tada",
          "users": [
            "iris"
          ]
        }
      ]
    },
    {
      "offset_seconds": 125,
      "type": "resolution",
      "channel": "#payment-alert",
      "user": "grace",
      "content": "\u2705 **RESOLVED** - Payment service back to normal\n\n**Root Cause:** Feature flag `paymentFailure` was accidentally left enabled by test automation, causing 50% of payment requests to fail\n\n**Fix:** Disabled the feature flag\n\n**Metrics After:**\n\u2022 Error rate: 0.2% (baseline) \u2713\n\u2022 Success rate: 99.8% \u2713\n\n**Impact:**\n\u2022 Duration: ~2 minutes of customer impact\n\u2022 Failed checkouts: ~78 orders\n\u2022 Revenue impact: ~$3,500 in failed transactions\n\n**Follow-up:**\n- [ ] Fix test automation to always clean up flags\n- [ ] Add safeguards to prevent production flags in test runs\n- [ ] Reach out to customers with failed orders",
      "metrics_after": {
        "error_rate": "0.2%",
        "success_rate": "99.8%"
      },
      "thread_parent": 8,
      "reactions": [
        {
          "emoji": "tada",
          "users": [
            "frank",
            "henry",
            "iris"
          ]
        }
      ]
    },
    {
      "offset_seconds": 130,
      "type": "message",
      "channel": "#checkout-alert",
      "user": "iris",
      "content": "@payment-oncall Thanks for the quick fix! Checkout is back to normal. Success rate at 98% \u2713",
      "mentions": [
        "@payment-oncall"
      ],
      "thread_parent": 0,
      "metrics_after": {
        "success_rate": "98%"
      }
    },
    {
      "offset_seconds": 135,
      "type": "message",
      "channel": "#payment-alert",
      "user": "frank",
      "content": "Sorry about that @iris! We'll make sure this doesn't happen again",
      "thread_parent": 8
    },
    {
      "offset_seconds": 145,
      "type": "alert",
      "channel": "#accounting-alert",
      "severity": "info",
      "title": "\u2139\ufe0f Unusual Pattern: High Failed Transaction Rate",
      "details": "Detected spike in failed transactions between 16:45-16:47\n\n**Metrics:**\n\u2022 Failed transactions: 78\n\u2022 Time window: 2 minutes\n\u2022 Estimated impact: $3,500\n\n**Note:** This appears to be related to a payment service incident that was already resolved",
      "metrics": {
        "failed_transactions": "78",
        "estimated_impact": "$3,500"
      },
      "thread_parent": null
    },
    {
      "offset_seconds": 150,
      "type": "message",
      "channel": "#accounting-alert",
      "user": "jack",
      "content": "Saw the spike in failures. Looks like @payment-oncall already resolved it. I'll note this for the reconciliation report",
      "thread_parent": 25
    },
    {
      "offset_seconds": 160,
      "type": "message",
      "channel": "#payment-alert",
      "user": "grace",
      "content": "I'm creating a ticket to fix the test automation flag cleanup. We can't have this happen again in prod",
      "thread_parent": 8
    },
    {
      "offset_seconds": 170,
      "type": "message",
      "channel": "#payment-alert",
      "user": "frank",
      "content": "Good call. Also maybe we should add a warning banner in flagd UI for production flags?",
      "thread_parent": 8
    },
    {
      "offset_seconds": 180,
      "type": "message",
      "channel": "#payment-alert",
      "user": "grace",
      "content": "Great idea! I'll add that to the ticket too",
      "thread_parent": 8,
      "reactions": [
        {
          "emoji": "+1",
          "users": [
            "frank"
          ]
        }
      ]
    }
  ],
  "metadata": {
    "severity": "SEV-2",
    "duration_seconds": 125,
    "services_impacted": 3,
    "root_cause": "Feature flag accidentally enabled by test automation",
    "resolution": "Disabled feature flag",
    "tags": [
      "payment",
      "checkout",
      "feature-flag",
      "test-automation",
      "revenue-impact"
    ]
  }
}