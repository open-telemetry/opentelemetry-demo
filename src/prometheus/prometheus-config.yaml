# Copyright The OpenTelemetry Authors
# SPDX-License-Identifier: Apache-2.0

global:
  # Align Prometheus scrape interval with the OTel SDKs' export interval for consistency (see OTEL_METRIC_EXPORT_INTERVAL)
  scrape_interval: 60s

otlp:
  keep_identifying_resource_attributes: true
  # Resource attributes are NOT promoted to labels on metrics.
  # Instead, use the experimental info() PromQL function to enrich metrics with
  # labels from target_info at query time. This reduces label cardinality while
  # still allowing access to resource attributes in queries.
  # See https://prometheus.io/blog/2025/12/16/introducing-info-function/
  promote_resource_attributes:
    # Kafka resource attributes produced by the OTel Collector Kafka receiver
    # https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/kafkametricsreceiver
    - kafka.cluster.alias

    # See https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/v0.142.0/connector/spanmetricsconnector/README.md#known-limitation-the-single-writer-principle
    - collector.instance.id

    # host.name is needed for system/host metrics from the hostmetrics receiver,
    # which cannot use info() because they lack service.name to match target_info.
    # k8s labels are promoted so PostgreSQL dashboard queries can filter on them
    # directly on the metric (works around Prometheus info() filtering bug when
    # filter labels already exist on the input metric).
    - host.name
    - k8s.cluster.name
    - k8s.statefulset.name
storage:
  tsdb:
    out_of_order_time_window: 30m
