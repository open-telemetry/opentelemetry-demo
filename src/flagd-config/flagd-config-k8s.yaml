# Kubernetes manifest for flagd-config
# Auto-generated from opentelemetry-demo.yaml
# Contains 2 resource(s): PVC and ConfigMap
---
# PersistentVolumeClaim for shared flagd configuration
# This PVC is shared between flagd and flagd-ui to enable dynamic flag updates
# Using ReadWriteOnce with podAffinity to ensure both pods on same node
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: flagd-shared-config
  labels:
    app.kubernetes.io/part-of: opentelemetry-demo
    app.kubernetes.io/component: flagd
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 100Mi
  storageClassName: local-path
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: flagd-config
  labels:
    app.kubernetes.io/version: 2.1.3
    app.kubernetes.io/part-of: opentelemetry-demo
data:
  demo.flagd.json: |
    {
      "$schema": "https://flagd.dev/schema/v0/flags.json",
      "flags": {
        "productCatalogFailure": {
          "description": "Fail product catalog service on a specific product",
          "state": "ENABLED",
          "variants": {
            "on": true,
            "off": false
          },
          "defaultVariant": "off"
        },
        "recommendationCacheFailure": {
          "description": "Fail recommendation service cache",
          "state": "ENABLED",
          "variants": {
            "on": true,
            "off": false
          },
          "defaultVariant": "off"
        },
        "adManualGc": {
          "description": "Triggers full manual garbage collections in the ad service",
          "state": "ENABLED",
          "variants": {
            "on": true,
            "off": false
          },
          "defaultVariant": "off"
        },
        "adHighCpu": {
          "description": "Triggers high cpu load in the ad service",
          "state": "ENABLED",
          "variants": {
            "on": true,
            "off": false
          },
          "defaultVariant": "off"
        },
        "adFailure": {
          "description": "Fail ad service",
          "state": "ENABLED",
          "variants": {
            "on": true,
            "off": false
          },
          "defaultVariant": "off"
        },
        "kafkaQueueProblems": {
          "description": "Overloads Kafka queue while simultaneously introducing a consumer side delay leading to a lag spike",
          "state": "ENABLED",
          "variants": {
            "on": 100,
            "off": 0
          },
          "defaultVariant": "off"
        },
        "paymentRetryMax": {
          "description": "Maximum number of payment retry attempts",
          "state": "ENABLED",
          "variants": {
            "10": 10,
            "5": 5,
            "4": 4,
            "2": 2,
            "1": 1
          },
          "defaultVariant": "4"
        },
        "fraudDetectionEnabled": {
          "description": "Enable fraud detection analysis on orders",
          "state": "ENABLED",
          "variants": {
            "on": 1,
            "off": 0
          },
          "defaultVariant": "on"
        },
        "mutateFraudOrders": {
          "description": "Percentage of orders to mutate for fraud alerts (0-100%)",
          "state": "ENABLED",
          "variants": {
            "off": 0,
            "medium": 40,
            "high": 60,
            "veryhigh": 90
          },
          "defaultVariant": "off"
        },
        "executeBadQueries": {
          "description": "Percentage of orders that trigger bad database queries (0-100%)",
          "state": "ENABLED",
          "variants": {
            "off": 0,
            "low": 20,
            "medium": 40,
            "high": 60
          },
          "defaultVariant": "off"
        },
        "cartFailure": {
          "description": "Fail cart service",
          "state": "ENABLED",
          "variants": {
            "on": true,
            "off": false
          },
          "defaultVariant": "off"
        },
        "paymentFailure": {
          "description": "Fail payment service charge requests n%",
          "state": "ENABLED",
          "variants": {
            "100%": 1,
            "90%": 0.95,
            "75%": 0.75,
            "50%": 0.5,
            "25%": 0.25,
            "10%": 0.1,
            "off": 0
          },
          "defaultVariant": "off"
        },
        "paymentUnreachable": {
          "description": "Payment service is unavailable",
          "state": "ENABLED",
          "variants": {
            "on": true,
            "off": false
          },
          "defaultVariant": "off"
        },
        "loadGeneratorFloodHomepage": {
          "description": "Flood the frontend with a large amount of requests.",
          "state": "ENABLED",
          "variants": {
            "on": 100,
            "off": 0
          },
          "defaultVariant": "off"
        },
        "imageSlowLoad": {
          "description": "slow loading images in the frontend",
          "state": "ENABLED",
          "variants": {
            "10sec": 10000,
            "5sec": 5000,
            "off": 0
          },
          "defaultVariant": "off"
        },
        "llmInaccurateResponse": {
          "defaultVariant": "off",
          "description": "LLM returns an inaccurate product summary for product ID L9ECAV7KIM",
          "state": "ENABLED",
          "variants": {
            "off": false,
            "on": true
          }
        },
        "llmRateLimitError": {
          "defaultVariant": "off",
          "description": "LLM intermittently returns a rate limit error",
          "state": "ENABLED",
          "variants": {
            "off": false,
            "on": true
          }
        }
      }
    }
