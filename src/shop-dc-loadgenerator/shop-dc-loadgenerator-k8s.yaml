### Expects a deployment of Astronomy Shop Demo in the same cluster
### Uses checkout service from that demo
### Or add this at config at the end of an astronomy shop demo deployment yaml
---
# Shop DC Load Generator
apiVersion: apps/v1
kind: Deployment
metadata:
  name: shop-dc-load-generator
  namespace: default
  labels:
    opentelemetry.io/name: shop-dc-load-generator
    app.kubernetes.io/component: shop-dc-load-generator
    app.kubernetes.io/name: shop-dc-load-generator
    app.kubernetes.io/version: "2.1.3"
    app.kubernetes.io/part-of: opentelemetry-demo
spec:
  replicas: 1
  selector:
    matchLabels:
      opentelemetry.io/name: shop-dc-load-generator
  template:
    metadata:
      labels:
        opentelemetry.io/name: shop-dc-load-generator
        app.kubernetes.io/component: shop-dc-load-generator
        app.kubernetes.io/name: shop-dc-load-generator
        app.kubernetes.io/version: "2.1.3"
        app.kubernetes.io/part-of: opentelemetry-demo
    spec:
      serviceAccountName: opentelemetry-demo
      initContainers:
        - name: wait-for-shop-dc-shim
          image: curlimages/curl:8.1.2
          command: ['sh', '-c']
          args:
            - |
              echo "Waiting for shop-dc-shim service to be ready..."
              until curl -f --connect-timeout 5 --max-time 20 http://shop-dc-shim:8070/actuator/health; do
                echo "Shop DC Shim not ready, waiting 20 seconds..."
                sleep 20
              done
              echo "Shop DC Shim is ready, starting load generator..."
          resources:
            limits:
              memory: "64Mi"
              cpu: "50m"
      containers:
        - name: load-generator
          image: ghcr.io/splunk/opentelemetry-demo/otel-shop-dc-loadgenerator:1.4.0
          args: ["--url", "http://shop-dc-shim:8070", "--mode", "continuous", "--tpm", "25", "--duration", "0"]
          resources:
            limits:
              memory: "128Mi"
              cpu: "100m"