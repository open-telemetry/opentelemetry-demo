{#- This template is rendered per service registry namespace. -#}
{#- Context variables provided by Weaver: -#}
{#- - ctx.id: The service id (e.g., "recommendation") -#}
{#- - ctx.groups: A sequence of all attribute groups for this service -#}
{#- - ctx.metrics: A sequence of all metrics for this service -#}
{%- import 'stability.j2' as stability -%}
{%- import 'attribute_macros.j2' as attrs -%}

{#- Helper macro to determine the registry category for an attribute -#}
{%- macro attr_category(attr_name) -%}
{%- if attr_name.startswith("app.product") or attr_name.startswith("app.products") or attr_name.startswith("app.filtered_products") or attr_name.startswith("app.ads") or attr_name.startswith("app.product_reviews") -%}
product
{%- elif attr_name.startswith("app.user") or attr_name.startswith("session") or attr_name.startswith("app.loyalty") -%}
user
{%- elif attr_name.startswith("app.order") or attr_name.startswith("app.cart") or attr_name.startswith("app.payment") -%}
order
{%- elif attr_name.startswith("app.shipping") or attr_name.startswith("app.quote") -%}
shipping
{%- else -%}
misc
{%- endif -%}
{%- endmacro -%}

<!-- NOTE: THIS FILE IS AUTOGENERATED. DO NOT EDIT BY HAND. -->
<!-- see templates/service.md.j2 -->

# {{ ctx.id | replace("_", " ") | title }} Service Telemetry Schema

## Overview

This page documents the telemetry schema for the **{{ ctx.id | replace("_", " ") | title }}** service, including all custom attributes and metrics.

{% for group in ctx.groups | sort(attribute="id") %}
{%- if group.attributes is defined and group.attributes | length > 0 %}
## Attributes

{{ group.brief }}

| Attribute | Stability | Type | Description |
|-----------|-----------|------|-------------|
{%- for attribute in group.attributes | sort(attribute="name") %}
| [`{{ attribute.name }}`](../attributes/{{ attr_category(attribute.name) }}.md#{{ attribute.name | replace(".", "") }}) | {{ stability.badge(attribute.stability, attribute.deprecated) }} | {{ attrs.type(attribute) }} | {{ attribute.brief | trim }} |
{%- endfor %}
{%- else %}

*No custom attributes defined for this service.*
{%- endif %}
{% endfor %}

{% if ctx.metrics is defined and ctx.metrics | length > 0 %}
## Metrics

| Metric | Instrument | Unit | Stability | Description |
|--------|------------|------|-----------|-------------|
{%- for metric in ctx.metrics | sort(attribute="metric_name") %}
| `{{ metric.metric_name }}` | {{ metric.instrument }} | {{ metric.unit }} | {{ stability.badge(metric.stability, metric.deprecated) }} | {{ metric.brief | trim }} |
{%- endfor %}

{% for metric in ctx.metrics | sort(attribute="metric_name") %}
{% if metric.attributes is defined and metric.attributes | length > 0 %}
### `{{ metric.metric_name }}` Attributes

| Attribute | Type | Description |
|-----------|------|-------------|
{%- for attribute in metric.attributes | sort(attribute="name") %}
| [`{{ attribute.name }}`](../attributes/{{ attr_category(attribute.name) }}.md#{{ attribute.name | replace(".", "") }}) | {{ attrs.type(attribute) }} | {{ attribute.brief | trim }} |
{%- endfor %}

{% endif %}
{%- endfor %}
{%- endif %}

